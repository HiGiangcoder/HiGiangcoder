#pragma once
#include "Database.h"
#include "Word.h"
#include "Lesson.h"
#include "User.h"

class DatabaseDAO {
private:
    Database* db;
public:
    explicit DatabaseDAO(Database* db);
    std::vector<Word> loadWords();
    std::vector<Lesson*> loadLessons();
    void saveUserProcess(const User& user);
};

#pragma once
#include <string>
#include <vector>
#include <sqlite3.h>

class Database {
private:
    sqlite3* db;              // member, không phải global
    std::string filename;

public:
    Database();                            // default ctor
    explicit Database(const std::string& file); // ctor mở DB (tùy chọn)
    ~Database();                           // dtor đóng DB

    bool connect(const std::string& path); // mở (hoặc đổi) DB
    bool execute(const std::string& sql);  // INSERT/UPDATE/DELETE
    std::vector<std::vector<std::string>> query(const std::string& sql); // SELECT
    void close();                          // đóng kết nối
};
#pragma once
#include "DatabaseDAO.h"
#include "User.h"
#include "LessonFactory.h"
#include "Logger.h"

/*
**Chức năng:**

- **Trái tim của ứng dụng** — nơi điều phối toàn bộ.

**Nhiệm vụ khi code:**

- Quản lý Database, DAO, Logger, User, danh sách Lessons.
- Giao diện CLI chính (`runCLI()`), hiển thị menu, gọi `Lesson.start()`.
- Load bài học qua `LessonFactory`.

**Cấu trúc logic:**

1. Load dữ liệu từ `DatabaseDAO`.
2. Hiển thị menu chính.
3. Gọi `Lesson.start()`.
4. Ghi tiến độ vào DB.
*/

class EnglishApp {
private:
    Database db;
    DatabaseDAO dao;
    User user;
public:
    EnglishApp();
    std::vector<Lesson*> getLessons();
    void run();
    User& getUser();
};#pragma once
#include "Lesson.h"
#include <vector>
using namespace std;

/*
Chức năng: Lưu các bài học ngữ pháp
*/
class GrammarLesson : public Lesson {
private:
    vector<string> rules;
public:
    GrammarLesson(int id, const string& title, vector<string> r);
    void start() override;
    void showResult() override;
    const std::vector<string>& getRules() const;
};
#pragma once
#include "Lesson.h"
#include "VocabularyLesson.h"
#include "GrammarLesson.h"
#include <string>
#include <vector>

using namespace std;

class LessonFactory {
public:
    static Lesson* createLesson(const string& type, int id, const string& title);
};
#pragma once
#include <string>
#include <vector>
#include <Word.h>

using namespace std;

/*
Chức năng: 
    Lớp trừu tượng (abstract base class) Đại diện cho mọi loại lesson
    Cung cấp Interface chung: start(), showResult()
*/
class Lesson {
protected:
    int id;
    string title;
public:
    Lesson(int id, const string& title);
    virtual void start() = 0; // Phuong thuc truu tuong: Hàm thuần ảo
    virtual void showResult() = 0;
    virtual ~Lesson() = default;
    const std::string& getTitle() const { return title; }
};
#pragma once
#include <string>
using namespace std;

class Logger {
public:
    static void info(const string& message);
    static void warn(const string& message);
    static void error(const string& message);
};
#pragma once
#include <string>

using namespace std;

class Test {
public:
    virtual void startTest() = 0;
    virtual ~Test() {}
    virtual void evaluate() = 0;
};

// Note: The implementation of the methods should be in a separate .cpp file.#pragma once
#include <string>
#include <map>
using namespace std;
/*
Chức năng: Lưu thông tin người học
*/

class User {
private:
    string username;
    string password;
    map<string, int> progress;
    int lessonCount;
public:
    explicit User(const string& user, const string& pass);
    bool authenticate(const string& pass) const;
    void completeLesson(const string& lesson);
    int getProgress(const string& lesson);
    string getName() const;
    int getLessonCount() const;
};
#pragma once
#include "Lesson.h"
#include "Word.h"
#include <vector>

/*
VocabularyLesson: Lop con cua Lesson, quan ly bai hoc tu vung
- id: ma bai hoc
- title: tieu de bai hoc
- words: danh sach cac tu vung trong bai hoc

Kế thừa từ Lesson
Quản lý danh sách Word
Xử lý logic học từ vựng
*/

class VocabularyLesson : public Lesson {
private:
    std::vector<Word> words;
public:
    VocabularyLesson(int id, const std::string& title, std::vector<Word> w);
    void start() override;
    void showResult() override;

    const std::vector<Word>& getWords() const;
};
#pragma once
#include <string>
using namespace std;

/*
Chức năng: Đại diện cho một từ vựng.
*/
class Word {
private:
    int id;
    string text;
    string meaning;
    string example;
public:
    Word(const string& t, const string& m);
    void display() const;
    string getText() const;
    const std::string& getMeaning() const;
};
import sys
import os

# Thêm thư mục hiện tại (chứa englishapp.so) vào sys.path
sys.path.append(os.path.abspath(".."))  # vì python_gui ở trong thư mục con

from englishapp import EnglishApp

app = EnglishApp()
lessons = app.getLessons()

def start_lesson(idx):
    lesson = lessons[idx]
    print(f"Starting lesson: {lesson.getTitle()}")
    lesson.start()
    lesson.showResult()

import tkinter as tk
root = tk.Tk()
root.title("English Learning App")

tk.Label(root, text="Lessons").pack()

for i, lesson in enumerate(lessons):
    btn = tk.Button(root, text=lesson.getTitle(), command=lambda idx=i: start_lesson(idx))
    btn.pack()

root.mainloop()
#include "Database.h"
#include <iostream>

// Default constructor: chưa mở DB
Database::Database() : db(nullptr), filename() {}

// Constructor với đường dẫn: cố gắng mở ngay
Database::Database(const std::string& file) : db(nullptr), filename(file) {
    if (!connect(file)) {
        std::cerr << "[Database] Warning: failed to open DB in ctor: " << file << std::endl;
    }
}

// Destructor: đóng nếu đang mở
Database::~Database() {
    close();
}

// Mở kết nối (hoặc chuyển sang DB mới)
bool Database::connect(const std::string& path) {
    // Nếu đang mở DB khác, đóng trước
    if (db) {
        sqlite3_close(db);
        db = nullptr;
    }

    int rc = sqlite3_open(path.c_str(), &db);
    if (rc != SQLITE_OK) {
        std::cerr << "[Database] Cannot open DB: " << sqlite3_errmsg(db) << std::endl;
        if (db) { sqlite3_close(db); db = nullptr; }
        return false;
    }
    filename = path;
    std::cout << "[Database] Connected to " << path << std::endl;
    return true;
}

// Thực thi câu lệnh không trả kết quả
bool Database::execute(const std::string& sql) {
    if (!db) {
        std::cerr << "[Database] execute: DB not opened\n";
        return false;
    }
    char* errMsg = nullptr;
    int rc = sqlite3_exec(db, sql.c_str(), nullptr, nullptr, &errMsg);
    if (rc != SQLITE_OK) {
        std::cerr << "[Database] SQL error: " << (errMsg ? errMsg : "") << std::endl;
        if (errMsg) sqlite3_free(errMsg);
        return false;
    }
    return true;
}

// Truy vấn và trả về bảng kết quả
std::vector<std::vector<std::string>> Database::query(const std::string& sql) {
    std::vector<std::vector<std::string>> results;
    if (!db) {
        std::cerr << "[Database] query: DB not opened\n";
        return results;
    }

    sqlite3_stmt* stmt = nullptr;
    int rc = sqlite3_prepare_v2(db, sql.c_str(), -1, &stmt, nullptr);
    if (rc != SQLITE_OK) {
        std::cerr << "[Database] prepare failed: " << sqlite3_errmsg(db) << std::endl;
        return results;
    }

    int cols = sqlite3_column_count(stmt);
    while ((rc = sqlite3_step(stmt)) == SQLITE_ROW) {
        std::vector<std::string> row;
        for (int i = 0; i < cols; ++i) {
            const unsigned char* text = sqlite3_column_text(stmt, i);
            row.emplace_back(text ? reinterpret_cast<const char*>(text) : "");
        }
        results.push_back(std::move(row));
    }

    if (rc != SQLITE_DONE) {
        std::cerr << "[Database] step error: " << sqlite3_errmsg(db) << std::endl;
    }

    sqlite3_finalize(stmt);
    return results;
}

// Đóng kết nối
void Database::close() {
    if (db) {
        sqlite3_close(db);
        db = nullptr;
        std::cout << "[Database] Connection closed." << std::endl;
    }
}
#include "DatabaseDAO.h"
#include "LessonFactory.h"
#include <iostream>

DatabaseDAO::DatabaseDAO(Database* db) : db(db) {}

std::vector<Word> DatabaseDAO::loadWords() {
    std::vector<Word> words;
    auto rows = db->query("SELECT text, meaning FROM words;");
    for (auto& row : rows) {
        words.emplace_back(row[0], row[1]);
    }
    return words;
}

std::vector<Lesson*> DatabaseDAO::loadLessons() {
    std::vector<Lesson*> lessons;
    auto rows = db->query("SELECT id, title, type FROM lessons;");
    for (auto& row : rows) {
        int id = std::stoi(row[0]);
        std::string title = row[1];
        std::string type = row[2];
        lessons.push_back(LessonFactory::createLesson(type, id, title));
    }
    return lessons;
}

void DatabaseDAO::saveUserProcess(const User& user) {
    // Tùy chọn: update bảng "progress" trong DB
    std::cout << "[DatabaseDAO] Saving user progress..." << std::endl;
}
#include <string>
#include <iostream>

#ifdef _WIN32
#include <conio.h>
std::string inputPassword(const std::string& prompt) {
    std::cout << prompt;
    std::string password;
    char ch;
    while ((ch = _getch()) != '\r') {  // enter key
        if (ch == '\b' && !password.empty()) {
            password.pop_back();
            std::cout << "\b \b";
        } else if (ch != '\b') {
            password.push_back(ch);
            std::cout << '*';
        }
    }
    std::cout << std::endl;
    return password;
}
#else
#include <termios.h>
#include <unistd.h>

std::string inputPassword(const std::string& prompt) {
    std::cout << prompt;
    termios oldt{}, newt{};
    tcgetattr(STDIN_FILENO, &oldt);
    newt = oldt;
    newt.c_lflag &= ~ECHO; // Tắt hiển thị ký tự
    tcsetattr(STDIN_FILENO, TCSANOW, &newt);

    std::string password;
    std::getline(std::cin, password);

    tcsetattr(STDIN_FILENO, TCSANOW, &oldt); // Bật lại echo
    std::cout << std::endl;
    return password;
}
#endif


#include "EnglishApp.h"
#include <iostream>

EnglishApp::EnglishApp() : dao(&db), user("Guest", "123456") {
    db.connect("data/english.db");
}

void EnglishApp::run() {
    Logger::info("EnglishApp started.");
    
    std::cout << "Enter username: ";
    std::string username;
    std::getline(std::cin, username);

    std::string password = inputPassword("Enter password: ");

    if (!user.authenticate(password)) {
        std::cout << "❌ Wrong password. Exiting...\n";
        return;
    }

    auto lessons = dao.loadLessons();

// void EnglishApp::run() {
//     Logger::info("EnglishApp started.");
//     auto lessons = dao.loadLessons();

    while (true) {
        std::cout << "\n--- English Learning CLI ---\n";
        std::cout << "1. View Lessons\n2. Exit\n> ";
        int choice;
        std::cin >> choice;
        std::cin.ignore();
        if (choice == 2) break;

        if (choice == 1) {
            int i = 1;
            for (auto* l : lessons)
                std::cout << i++ << ". " << "Lesson ID " << i-1 << "\n";

            std::cout << "Select lesson: ";
            int sel; std::cin >> sel; std::cin.ignore();
            if (sel > 0 && sel <= (int)lessons.size()) {
                lessons[sel - 1]->start();
                lessons[sel - 1]->showResult();
                user.completeLesson("Lesson_" + std::to_string(sel));
            }
        }
    }

    db.close();
    Logger::info("Application closed.");
}

std::vector<Lesson*> EnglishApp::getLessons() { 
    return this->dao.loadLessons(); 
}

User& EnglishApp::getUser() { 
    return this->user; 
}#include "GrammarLesson.h"
#include <iostream>

GrammarLesson::GrammarLesson(int id, const std::string& title, std::vector<std::string> r)
    : Lesson(id, title), rules(std::move(r)) {}

void GrammarLesson::start() {
    std::cout << "\n[Lesson] Grammar: " << title << "\n";
    // ... (hiển thị quy tắc và câu ví dụ)
}

void GrammarLesson::showResult() {
    std::cout << "[Result] Grammar lesson complete.\n";
}

const std::vector<string>& GrammarLesson::getRules() const {
    return rules; 
}#include "Lesson.h"

Lesson::Lesson(int id, const std::string& title)
    : id(id), title(title) {}
#include "LessonFactory.h"
#include <iostream>

Lesson* LessonFactory::createLesson(const std::string& type, int id, const std::string& title) {
    if (type == "vocabulary") {
        std::vector<Word> dummy = { Word("apple", "quả táo"), Word("book", "quyển sách") };
        return new VocabularyLesson(id, title, dummy);
    } else if (type == "grammar") {
        std::vector<std::string> rules = { "Use 'a' before consonant sounds", "Use 'an' before vowel sounds" };
        return new GrammarLesson(id, title, rules);
    }
    std::cerr << "[Factory] Unknown lesson type: " << type << std::endl;
    return nullptr;
}
#include "Logger.h"
#include <iostream>

void Logger::info(const std::string& msg) {
    std::cout << "[INFO] " << msg << std::endl;
}

void Logger::warn(const std::string& msg) {
    std::cout << "[WARN] " << msg << std::endl;
}

void Logger::error(const std::string& msg) {
    std::cerr << "[ERROR] " << msg << std::endl;
}
/*
### `main.cpp`

**Chức năng:**

- Điểm khởi đầu của chương trình.
- Khởi tạo `EnglishApp` và chạy CLI hoặc GUI.

**Khi code:**

- CLI: `app.runCLI()`
- GUI: `QApplication app(argc, argv); MainWindow window; window.show();`
*/

#include "EnglishApp.h"

int main() {
    EnglishApp app;
    app.run(); // chạy CLI
    return 0;
}#include <pybind11/pybind11.h>
#include "EnglishApp.h"

namespace py = pybind11;

PYBIND11_MODULE(englishapp, m) {
    py::class_<EnglishApp>(m, "EnglishApp")
        .def(py::init<>())
        .def("run", &EnglishApp::run)
        .def("getLessons", &EnglishApp::getLessons);
}
#include "User.h"
#include <iostream>


User::User(const string& user, const string& pass) 
    : username(user), password(pass) {
    this->lessonCount = 0;
}

// Xác nhận mật khẩu
bool User::authenticate(const string& pass) const {
    return password == pass;
}

// Tăng số lần hoàn thành bài học đó lên 1
void User::completeLesson(const string& lesson) {
    this->progress[lesson]++;
    this->lessonCount ++;
    std::cout << "[User] Completed: " << lesson << std::endl;
}

// Lấy kết quả số lần hoàn thành bài học đó
int User::getProgress(const string& lesson) {
    return progress[lesson];
}

std::string User::getName() const {
    return this->username;
}

// Getter cho lessonCount
int User::getLessonCount() const {
    return this->lessonCount;
}#include "VocabularyLesson.h"
#include <iostream>

VocabularyLesson::VocabularyLesson(int id, const std::string& title, std::vector<Word> w) 
    : Lesson(id, title), words(w) {}

void VocabularyLesson::start() {
    std::cout << "\n[Lesson] Vocabulary: " << title << "\n";
    for (auto& word : words) {
        std::cout << "Meaning of '" << word.getText() << "'? ";
        std::string ans;
        std::getline(std::cin, ans);
        // ... (so sánh ans và meaning)
    }
}

inline void VocabularyLesson::showResult() {
    printf("Vocabulary Lesson %s completed. Total words: %zu\n", title.c_str(), words.size());
}

const std::vector<Word>& VocabularyLesson::getWords() const {
    return words; 
}#include "Word.h"
#include <iostream>

Word::Word(const std::string& t, const std::string& m) : text(t), meaning(m) {}

void Word::display() const {
    std::cout << text << " - " << meaning << std::endl;
}

std::string Word::getText() const {
    return text;
}

const std::string& Word::getMeaning() const { 
    return meaning; 
}.
├── build
│   ├── databaseDAO.o
│   ├── Database.o
│   ├── EnglishApp.o
│   ├── GrammarLesson.o
│   ├── LessonFactory.o
│   ├── Lesson.o
│   ├── Logger.o
│   ├── main.o
│   ├── python_bindings.o
│   ├── Test.o
│   ├── User.o
│   ├── VocabularyLesson.o
│   └── Word.o
├── CMakeLists.txt
├── data
│   └── english.db
├── englishapp.so
├── English_App_UML.dot
├── english_app_uml.png
├── include
│   ├── DatabaseDAO.h
│   ├── Database.h
│   ├── EnglishApp.h
│   ├── GrammarLesson.h
│   ├── LessonFactory.h
│   ├── Lesson.h
│   ├── Logger.h
│   ├── Test.h
│   ├── User.h
│   ├── VocabularyLesson.h
│   └── Word.h
├── log_test.txt
├── main
├── makefile
├── python_gui
│   └── main.py
├── run_english.py
└── src
    ├── Database.cpp
    ├── databaseDAO.cpp
    ├── EnglishApp.cpp
    ├── GrammarLesson.cpp
    ├── Lesson.cpp
    ├── LessonFactory.cpp
    ├── Logger.cpp
    ├── main.cpp
    ├── python_bindings.cpp
    ├── Test.cpp
    ├── User.cpp
    ├── VocabularyLesson.cpp
    └── Word.cpp

6 directories, 47 files
